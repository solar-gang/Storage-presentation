<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solar + Storage Presentation | Guided Sales Flow</title>
  <meta name="description" content="Enterprise-grade one-page guided solar + storage presentation with a 25-year utility vs options calculator." />
  <style>
    :root{
      --bg: #070A12;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.085);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --muted2: rgba(255,255,255,.55);
      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 14px;
      --max: 1220px;

      /* Utility theme defaults (will swap via JS) */
      --utilityA: #D1202E;     /* primary */
      --utilityB: #FFCF36;     /* accent */
      --utilityName: "Southern California Edison";

      /* Proposal theme */
      --proposalA: #22C55E;    /* green */
      --proposalB: #60A5FA;    /* blue */
      --proposalC: #A78BFA;    /* purple */

      --good: #22C55E;
      --warn: #F59E0B;
      --bad:  #EF4444;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(96,165,250,.25), transparent 55%),
        radial-gradient(900px 500px at 85% 15%, rgba(167,139,250,.20), transparent 55%),
        radial-gradient(1000px 650px at 50% 110%, rgba(34,197,94,.18), transparent 60%),
        linear-gradient(180deg, #050712 0%, #070A12 40%, #050712 100%);
      overflow-x:hidden;
    }

    a{ color: rgba(255,255,255,.90); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    .wrap{ max-width: var(--max); margin:0 auto; padding: 26px 18px 90px; }

    /* Top bar */
    .top{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding: 14px 16px; border: 1px solid var(--stroke); border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      position: sticky; top: 14px; z-index: 10;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; gap:12px; align-items:center; min-width: 280px;
    }
    .mark{
      width:40px; height:40px; border-radius: 12px;
      background:
        radial-gradient(circle at 25% 30%, rgba(255,255,255,.25), transparent 50%),
        linear-gradient(135deg, var(--utilityA), rgba(34,197,94,.75));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      position: relative;
    }
    .mark:after{
      content:"";
      position:absolute; inset:10px;
      border-radius: 10px;
      border:1px solid rgba(255,255,255,.18);
      opacity:.6;
    }
    .brand h1{
      margin:0; font-size: 14px; letter-spacing:.35px; font-weight: 650;
      line-height: 1.1;
    }
    .brand p{ margin:2px 0 0; font-size:12px; color: var(--muted2); }

    .controls{
      display:flex; gap:10px; align-items:center; justify-content:flex-end; flex-wrap:wrap;
    }
    .pill{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius: 999px;
      padding: 10px 12px;
      display:flex; gap:10px; align-items:center;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    select, input[type="text"], input[type="number"]{
      font: inherit;
      color: var(--text);
      background: transparent;
      border: 0;
      outline: none;
    }
    select{ cursor:pointer; }
    .btn{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 620;
      letter-spacing: .2px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.085); border-color: rgba(255,255,255,.22); }
    .btn:active{ transform: translateY(0px); }

    /* Hero */
    .hero{
      margin-top: 18px;
      border-radius: 26px;
      border: 1px solid var(--stroke);
      background:
        radial-gradient(900px 420px at 8% 10%, rgba(255,255,255,.10), transparent 58%),
        radial-gradient(740px 380px at 92% 18%, rgba(255,255,255,.07), transparent 58%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      padding: 22px 18px 16px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position: relative;
    }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      align-items: stretch;
    }
    @media (max-width: 960px){
      .hero-grid{ grid-template-columns: 1fr; }
      .brand{ min-width: unset; }
      .top{ gap: 12px; flex-wrap:wrap; }
    }

    .title{
      margin: 0 0 10px;
      font-size: 30px;
      line-height: 1.08;
      letter-spacing: -.6px;
    }
    .subtitle{
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 14.5px;
      line-height: 1.55;
      max-width: 68ch;
    }
    .badge-row{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .badge{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
    }
    .badge strong{ color: rgba(255,255,255,.92); font-weight: 700; }

    .hero-card{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 20px;
      background:
        radial-gradient(280px 120px at 20% 20%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(260px 140px at 80% 25%, rgba(96,165,250,.15), transparent 60%),
        rgba(0,0,0,.18);
      padding: 14px 14px 12px;
    }
    .hero-card h3{ margin: 4px 0 8px; font-size: 13px; color: rgba(255,255,255,.92); letter-spacing:.25px; }
    .hero-card ul{ margin: 0; padding-left: 16px; color: var(--muted); font-size: 13px; line-height: 1.5; }
    .hero-card li{ margin: 6px 0; }

    /* Sections */
    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 960px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.05);
      box-shadow: 0 24px 80px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .card-h{
      padding: 14px 14px 10px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    .card-h h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.25px;
    }
    .card-h p{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12.8px;
      line-height: 1.45;
    }
    .card-b{ padding: 12px 14px 14px; }

    .kpi-row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .kpi{
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(0,0,0,.16);
      padding: 12px;
    }
    .kpi .label{ font-size: 11px; color: var(--muted2); letter-spacing:.25px; }
    .kpi .value{ margin-top: 6px; font-size: 18px; font-weight: 760; }
    .kpi .hint{ margin-top: 6px; font-size: 12px; color: var(--muted); line-height:1.45; }

    .callout{
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(240px 120px at 15% 10%, rgba(255,255,255,.08), transparent 60%),
        rgba(0,0,0,.16);
      padding: 12px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }
    .callout strong{ color: rgba(255,255,255,.90); }

    .sources{
      display:flex; flex-direction:column; gap:8px;
      margin-top: 10px;
    }
    .src{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      padding: 10px 10px;
      border-radius: 12px;
      font-size: 12.5px;
      color: var(--muted);
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
    }
    .src a{ color: rgba(255,255,255,.88); }
    .tag{
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.70);
      white-space:nowrap;
      background: rgba(255,255,255,.04);
    }

    /* Calculator */
    .calc{
      grid-column: 1 / -1;
    }
    .calc-grid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 960px){ .calc-grid{ grid-template-columns: 1fr; } }

    .col{
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      background: rgba(0,0,0,.16);
      padding: 12px;
      position: relative;
      overflow:hidden;
    }
    .col:before{
      content:"";
      position:absolute; inset:-60px -60px auto auto;
      width:160px; height:160px; border-radius: 50%;
      filter: blur(0px);
      opacity:.18;
    }
    .col.utility:before{ background: radial-gradient(circle at 40% 40%, var(--utilityB), transparent 65%); }
    .col.optA:before{ background: radial-gradient(circle at 40% 40%, var(--proposalB), transparent 65%); }
    .col.optB:before{ background: radial-gradient(circle at 40% 40%, var(--proposalC), transparent 65%); }

    .colhead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 10px;
    }
    .colhead h3{
      margin:0;
      font-size: 13px;
      letter-spacing:.25px;
    }
    .chip{
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.80);
      white-space:nowrap;
    }
    .chip.utility{ border-color: rgba(255,255,255,.16); }
    .chip.utility span{ color: rgba(255,255,255,.90); }
    .chip.a{ border-color: rgba(96,165,250,.40); }
    .chip.b{ border-color: rgba(167,139,250,.40); }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .field{
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      padding: 10px;
    }
    .field label{
      display:block;
      font-size: 11px;
      color: var(--muted2);
      margin-bottom: 6px;
      letter-spacing:.2px;
    }
    .field input{
      width:100%;
      font-weight: 700;
      font-size: 14px;
    }
    .field small{
      display:block;
      margin-top: 6px;
      color: var(--muted);
      font-size: 11.5px;
      line-height: 1.35;
    }
    .field.full{ grid-column: 1 / -1; }

    .summary{
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      color: var(--muted);
      font-size: 12.5px;
    }
    .summary strong{ color: rgba(255,255,255,.92); }
    .summary .big{
      font-size: 18px; font-weight: 820; color: rgba(255,255,255,.94);
      letter-spacing: -.2px;
    }
    .summary .good{ color: var(--good); }
    .summary .warn{ color: var(--warn); }
    .summary .bad{ color: var(--bad); }

    /* Table */
    .tablewrap{
      margin-top: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size: 12.5px;
      background: rgba(0,0,0,.16);
    }
    thead th{
      text-align:left;
      padding: 10px;
      color: rgba(255,255,255,.88);
      background: rgba(255,255,255,.05);
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-weight: 700;
      letter-spacing:.2px;
    }
    tbody td{
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      color: var(--muted);
    }
    tbody tr:hover td{ background: rgba(255,255,255,.03); color: rgba(255,255,255,.86); }
    .mono{ font-family: var(--mono); }

    /* Footer */
    .foot{
      margin-top: 16px;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.55;
      border-top: 1px solid rgba(255,255,255,.08);
      padding-top: 14px;
    }

    /* Step toggles */
    .steps{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top: 12px;
    }
    .step{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-size: 12px;
      color: var(--muted);
      user-select:none;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .step:hover{ transform: translateY(-1px); background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.22); }
    .step.active{
      color: rgba(255,255,255,.92);
      border-color: rgba(255,255,255,.26);
      background: rgba(255,255,255,.08);
    }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- Sticky top bar -->
    <div class="top">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <h1>Solar + Storage Presentation</h1>
          <p>Guided trust-first flow + 25-year calculator</p>
        </div>
      </div>

      <div class="controls">
        <div class="pill" title="Select the customer’s utility">
          <span style="color:var(--muted2); font-size:12px; letter-spacing:.2px;">Utility</span>
          <select id="utilitySelect" aria-label="Select utility">
            <option value="sce">Southern California Edison (SCE)</option>
            <option value="pge">PG&E</option>
            <option value="sdge">SDG&E</option>
          </select>
        </div>

        <button class="btn" id="copyLinkBtn" title="Copies this page URL for texting to customers">Copy Page Link</button>
        <button class="btn" id="resetBtn" title="Reset calculator inputs">Reset Inputs</button>
      </div>
    </div>

    <!-- Hero -->
    <section class="hero">
      <div class="hero-grid">
        <div>
          <h2 class="title">Store the sun. Own the night.</h2>
          <p class="subtitle">
            This page walks you through a clean, trust-building solar + storage presentation.
            Use it live with the homeowner: confirm today’s bill + cost/kWh, show why rates rise,
            explain Time-of-Use (4–9pm), then compare two storage-backed options against the utility for 25 years.
          </p>

          <div class="badge-row">
            <div class="badge"><strong>Trust-first</strong> (sources built in)</div>
            <div class="badge"><strong>One-page</strong> guided flow</div>
            <div class="badge"><strong>25-year</strong> side-by-side math</div>
            <div class="badge"><strong>Utility themes</strong> SCE / PG&E / SDG&E</div>
          </div>

          <div class="steps" aria-label="Presentation steps">
            <div class="step active" data-step="problem">1) Problem</div>
            <div class="step" data-step="tou">2) TOU 4–9</div>
            <div class="step" data-step="storage">3) Storage</div>
            <div class="step" data-step="backup">4) Backup</div>
            <div class="step" data-step="vpp">5) VPP</div>
            <div class="step" data-step="calc">6) Compare</div>
            <div class="step" data-step="close">7) Close</div>
          </div>
        </div>

        <div class="hero-card">
          <h3>Live talk-track checklist</h3>
          <ul>
            <li>Confirm the customer’s <b>average bill</b> + <b>effective ¢/kWh</b> (build agreement).</li>
            <li>Show <b>why rates rise</b> (source links) and why TOU punishes 4–9pm daily.</li>
            <li>Explain <b>storage</b>: shift usage, avoid peak, add outage protection.</li>
            <li>Introduce <b>Tesla Powerwall 3</b> backup + <b>Virtual Power Plant</b> earnings potential.</li>
            <li>Run the <b>25-year comparison</b> and focus on “no-day-one-savings = we stop.”</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Content grid -->
    <div class="grid">

      <!-- Problem -->
      <section class="card" id="step-problem">
        <div class="card-h">
          <div>
            <h2>1) The Problem: rising electricity costs</h2>
            <p>Use primary sources. Keep it calm: “This is why bills keep changing.”</p>
          </div>
          <span class="tag" id="utilityTag">SCE sources</span>
        </div>
        <div class="card-b">
          <div class="kpi-row">
            <div class="kpi">
              <div class="label">Customer’s current avg monthly bill</div>
              <div class="value" id="kpiBill">$—</div>
              <div class="hint">Confirm what they actually pay on average (not the best month).</div>
            </div>
            <div class="kpi">
              <div class="label">Customer’s effective cost per kWh</div>
              <div class="value" id="kpiCents">— ¢/kWh</div>
              <div class="hint">Agree on ¢/kWh from their bill (or estimate in the calculator).</div>
            </div>
          </div>

          <div class="callout" id="problemTalk">
            <strong>Talk track:</strong> “Utilities don’t sell solar. They sell electricity. When their costs rise—wildfire hardening, grid upgrades,
            program costs—rates follow. Our job is to give you a stable alternative and protect you from peak pricing.”
          </div>

          <div class="sources" id="problemSources">
            <!-- filled by JS -->
          </div>
        </div>
      </section>

      <!-- TOU -->
      <section class="card" id="step-tou">
        <div class="card-h">
          <div>
            <h2>2) Time-of-Use: the 4–9pm penalty</h2>
            <p>Frame it simply: you’re charged more during peak hours every weekday.</p>
          </div>
          <span class="tag">Peak window</span>
        </div>
        <div class="card-b">
          <div class="callout">
            <strong>Talk track:</strong> “Peak is when families are home—cooking, laundry, HVAC, TV, EV charging.
            TOU doesn’t care if you ‘used less overall’—it cares <em>when</em> you used it.”
          </div>

          <div class="kpi-row" style="margin-top:10px;">
            <div class="kpi">
              <div class="label">Peak window (typical)</div>
              <div class="value">4–9pm</div>
              <div class="hint">Exact TOU periods vary by plan, season, and utility.</div>
            </div>
            <div class="kpi">
              <div class="label">What storage does here</div>
              <div class="value">Shifts usage</div>
              <div class="hint">Charge off-peak / solar hours → use battery during 4–9pm.</div>
            </div>
          </div>

          <div class="callout" style="margin-top:10px;">
            <strong>Keep it non-salesy:</strong> “If we can’t show savings and control, we won’t move forward.”
          </div>
        </div>
      </section>

      <!-- Storage -->
      <section class="card" id="step-storage">
        <div class="card-h">
          <div>
            <h2>3) Storage solves TOU + adds control</h2>
            <p>Battery = “time machine” for solar. Use solar when it’s most expensive.</p>
          </div>
          <span class="tag">Solar + Storage</span>
        </div>
        <div class="card-b">
          <div class="kpi-row">
            <div class="kpi">
              <div class="label">Goal</div>
              <div class="value">Buy less peak</div>
              <div class="hint">Reduce dependence on 4–9pm pricing.</div>
            </div>
            <div class="kpi">
              <div class="label">How</div>
              <div class="value">Store midday</div>
              <div class="hint">Solar charges battery → battery runs home during peak.</div>
            </div>
          </div>
          <div class="callout">
            <strong>Talk track:</strong> “Solar alone is helpful. Solar + storage is control. It’s not just generating power—it’s choosing
            <em>when</em> you use your power.”
          </div>
        </div>
      </section>

      <!-- Backup -->
      <section class="card" id="step-backup">
        <div class="card-h">
          <div>
            <h2>4) Backup: Powerwall 3 benefits</h2>
            <p>Outage protection is an emotional benefit—tie it to practical moments.</p>
          </div>
          <span class="tag">Resilience</span>
        </div>
        <div class="card-b">
          <div class="callout">
            <strong>Talk track:</strong> “Even if you never have a long outage, you’ll feel the value the first time the neighborhood goes dark and your home stays on.”
          </div>

          <!-- OPTIONAL: Add your outage video -->
          <div class="callout" style="margin-top:10px;">
            <strong>Optional:</strong> Embed your outage demo video (replace URL below in the code).
            <div style="margin-top:10px; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.10);">
              <iframe id="outageVideo" width="100%" height="250" style="display:block;" src="" title="Outage Demo Video"
                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div style="margin-top:8px; color:var(--muted2); font-size:12px;">
              To enable: set <span class="mono">OUTAGE_VIDEO_URL</span> in the script near the bottom.
            </div>
          </div>
        </div>
      </section>

      <!-- VPP -->
      <section class="card" id="step-vpp">
        <div class="card-h">
          <div>
            <h2>5) Tesla Virtual Power Plant: potential earnings</h2>
            <p>Keep it factual: programs vary by utility and season.</p>
          </div>
          <span class="tag">VPP</span>
        </div>
        <div class="card-b">
          <div class="callout">
            <strong>Talk track:</strong> “A VPP is when thousands of home batteries act like a small power plant. When the grid needs help,
            your battery can export during events—some programs compensate you.”
          </div>

          <div class="sources" id="vppSources">
            <!-- filled by JS -->
          </div>

          <!-- OPTIONAL: show check images (replace with your own image URLs) -->
          <div class="callout" style="margin-top:10px;">
            <strong>Optional:</strong> Add “sample checks” images (your own photos/screenshots). Put your image URLs into
            <span class="mono">VPP_CHECK_IMAGE_URLS</span> in the script.
            <div id="checkRow" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;"></div>
          </div>
        </div>
      </section>

      <!-- Calculator -->
      <section class="card calc" id="step-calc">
        <div class="card-h">
          <div>
            <h2>6) 25-year comparison: Utility vs two options</h2>
            <p>Enter the agreed monthly bill + annual increase. The table + totals + savings update instantly.</p>
          </div>
          <span class="tag">Calculator</span>
        </div>
        <div class="card-b">

          <div class="calc-grid">

            <!-- Utility column -->
            <div class="col utility">
              <div class="colhead">
                <h3 id="utilityColTitle">Utility (SCE)</h3>
                <div class="chip utility"><span>Baseline</span></div>
              </div>

              <div class="form">
                <div class="field full">
                  <label>Current average monthly bill ($)</label>
                  <input id="uMonthly" type="number" min="0" step="1" placeholder="e.g., 320" />
                  <small>Confirm with homeowner. Use average over multiple months if possible.</small>
                </div>
                <div class="field">
                  <label>Annual increase (%)</label>
                  <input id="uEsc" type="number" min="0" step="0.1" placeholder="e.g., 6.0" />
                  <small>Agree on a realistic assumption together.</small>
                </div>
                <div class="field">
                  <label>Usage estimate (kWh / month)</label>
                  <input id="uKwh" type="number" min="0" step="1" placeholder="e.g., 700" />
                  <small>Optional. Used to estimate ¢/kWh.</small>
                </div>
              </div>

              <div class="summary" style="margin-top:10px;">
                <div>
                  <div style="color:var(--muted2); font-size:11px;">25-year total (Utility)</div>
                  <div class="big" id="uTotal">$—</div>
                </div>
                <div>
                  <div style="color:var(--muted2); font-size:11px;">Estimated effective rate</div>
                  <div class="big" id="uCents">— ¢/kWh</div>
                </div>
              </div>
            </div>

            <!-- Option A -->
            <div class="col optA">
              <div class="colhead">
                <h3>Option A (Solar + Storage)</h3>
                <div class="chip a">Proposal 1</div>
              </div>

              <div class="form">
                <div class="field full">
                  <label>Monthly payment ($)</label>
                  <input id="aMonthly" type="number" min="0" step="1" placeholder="e.g., 255" />
                  <small>Set what you’re offering the customer.</small>
                </div>
                <div class="field">
                  <label>Annual escalator (%)</label>
                  <input id="aEsc" type="number" min="0" step="0.1" placeholder="e.g., 0.0" />
                  <small>Loan/PPA escalator (if any).</small>
                </div>
                <div class="field">
                  <label>Notes (optional)</label>
                  <input id="aNotes" type="text" placeholder="e.g., 1x PW3, fixed payment" />
                  <small>Shown in your close section.</small>
                </div>
              </div>

              <div class="summary">
                <div>
                  <div style="color:var(--muted2); font-size:11px;">25-year total (Option A)</div>
                  <div class="big" id="aTotal">$—</div>
                </div>
                <div>
                  <div style="color:var(--muted2); font-size:11px;">Savings vs Utility</div>
                  <div class="big" id="aSave">$—</div>
                </div>
              </div>
            </div>

            <!-- Option B -->
            <div class="col optB">
              <div class="colhead">
                <h3>Option B (Solar + More Storage)</h3>
                <div class="chip b">Proposal 2</div>
              </div>

              <div class="form">
                <div class="field full">
                  <label>Monthly payment ($)</label>
                  <input id="bMonthly" type="number" min="0" step="1" placeholder="e.g., 285" />
                  <small>Premium option (more backup / more peak coverage).</small>
                </div>
                <div class="field">
                  <label>Annual escalator (%)</label>
                  <input id="bEsc" type="number" min="0" step="0.1" placeholder="e.g., 0.0" />
                  <small>Loan/PPA escalator (if any).</small>
                </div>
                <div class="field">
                  <label>Notes (optional)</label>
                  <input id="bNotes" type="text" placeholder="e.g., 2x PW3, max TOU control" />
                  <small>Shown in your close section.</small>
                </div>
              </div>

              <div class="summary">
                <div>
                  <div style="color:var(--muted2); font-size:11px;">25-year total (Option B)</div>
                  <div class="big" id="bTotal">$—</div>
                </div>
                <div>
                  <div style="color:var(--muted2); font-size:11px;">Savings vs Utility</div>
                  <div class="big" id="bSave">$—</div>
                </div>
              </div>
            </div>

          </div>

          <div class="tablewrap">
            <table aria-label="25-year projection table">
              <thead>
                <tr>
                  <th style="width:70px;">Year</th>
                  <th id="thUtil">Utility</th>
                  <th>Option A</th>
                  <th>Option B</th>
                  <th>Savings A</th>
                  <th>Savings B</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="callout" style="margin-top:12px;">
            <strong>Rule:</strong> If there’s no day-one savings or no clear value, stop and adjust. Trust > pressure.
          </div>

        </div>
      </section>

      <!-- Close -->
      <section class="card" id="step-close">
        <div class="card-h">
          <div>
            <h2>7) Close: decision framework (no pressure)</h2>
            <p>Use an “educated decision” close: clarity, timeline, next steps.</p>
          </div>
          <span class="tag">Close</span>
        </div>
        <div class="card-b">
          <div class="callout" id="closeTalk">
            <strong>Close talk track:</strong> “Our goal is simple: by the end of today you should have enough information
            to make an educated decision. If we can’t improve your situation, we won’t move forward.”
          </div>

          <div class="kpi-row" style="margin-top:10px;">
            <div class="kpi">
              <div class="label">Option A summary</div>
              <div class="value" id="closeA">—</div>
              <div class="hint" id="closeANotes">—</div>
            </div>
            <div class="kpi">
              <div class="label">Option B summary</div>
              <div class="value" id="closeB">—</div>
              <div class="hint" id="closeBNotes">—</div>
            </div>
          </div>

          <div class="callout" style="margin-top:10px;">
            <strong>Next steps (example):</strong>
            <ol style="margin:8px 0 0; padding-left: 18px; color: var(--muted); line-height:1.55;">
              <li>Confirm homeowner + home qualifies (roof, ownership, credit, property status).</li>
              <li>Schedule site survey / measurements.</li>
              <li>Review final design with both decision makers before permits.</li>
              <li>Submit to utility / permitting when customer signs off.</li>
            </ol>
          </div>

          <div class="foot">
            <div><b>Pro tip:</b> Keep screenshots of sources updated monthly (rate advisories, CPUC summaries) and swap links in the “Sources” section.</div>
            <div style="margin-top:8px;">
              <span class="mono">Disclaimer:</span> This is a sales tool, not legal/financial advice. Rates, programs, and incentives change by utility, plan, and season.
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <script>
    /***************
      CONFIG (EDIT ME)
    ****************/
    // Optional: paste a YouTube embed URL (NOT a normal watch URL).
    // Example embed URL format: https://www.youtube.com/embed/VIDEO_ID
    const OUTAGE_VIDEO_URL = ""; // <-- put your embed URL here (or leave blank)

    // Optional: add your own VPP "check" images (URLs).
    const VPP_CHECK_IMAGE_URLS = [
      // "https://yourdomain.com/check1.jpg",
      // "https://yourdomain.com/check2.jpg",
    ];

    /***************
      THEME + SOURCES
    ****************/
    const UTILITIES = {
      sce: {
        label: "Southern California Edison (SCE)",
        short: "SCE",
        colors: { A: "#D1202E", B: "#FFCF36" },
        sources: [
          {
            title: "SCE: Understanding updates to your bill (mentions ~13% residential increase on October bills)",
            url: "https://www.sce.com/save-money/rates-financing/residential-rate-plans/understanding-updates-to-your-bill",
            tag: "Primary source"
          },
          {
            title: "CPUC SB-695 report: forecasts average annual bundled rate increases (context + drivers)",
            url: "https://www.cpuc.ca.gov/-/media/cpuc-website/divisions/office-of-governmental-affairs-division/reports/2025/2025-sb-695-report_093025.pdf",
            tag: "CPUC"
          },
          {
            title: "CPUC: SCE General Rate Case proceedings (base revenue request + multi-year scope)",
            url: "https://www.cpuc.ca.gov/industries-and-topics/electrical-energy/electric-rates/general-rate-case/southern-california-edison-grc-proceedings",
            tag: "CPUC"
          }
        ],
        vpp: [
          {
            title: "Tesla VPP with SCE (DSGS): program overview + compensation notes",
            url: "https://www.tesla.com/support/energy/virtual-power-plant/sce",
            tag: "Tesla"
          }
        ]
      },
      pge: {
        label: "Pacific Gas & Electric (PG&E)",
        short: "PG&E",
        colors: { A: "#0071CE", B: "#FFD100" },
        sources: [
          {
            title: "CPUC SB-695 report: forecasts average annual bundled rate increases (context + drivers)",
            url: "https://www.cpuc.ca.gov/-/media/cpuc-website/divisions/office-of-governmental-affairs-division/reports/2025/2025-sb-695-report_093025.pdf",
            tag: "CPUC"
          },
          {
            title: "PG&E: General Rate Case page (context on forecasting / timing)",
            url: "https://www.pge.com/en/regulation/general-rate-case.html",
            tag: "Utility page"
          }
        ],
        vpp: [
          {
            title: "Tesla VPP with PG&E (ELRP): program details + $/kWh language",
            url: "https://www.tesla.com/support/energy/virtual-power-plant/pge",
            tag: "Tesla"
          }
        ]
      },
      sdge: {
        label: "San Diego Gas & Electric (SDG&E)",
        short: "SDG&E",
        colors: { A: "#00A6E7", B: "#9BE15D" },
        sources: [
          {
            title: "CPUC SB-695 report: forecasts average annual bundled rate increases (context + drivers)",
            url: "https://www.cpuc.ca.gov/-/media/cpuc-website/divisions/office-of-governmental-affairs-division/reports/2025/2025-sb-695-report_093025.pdf",
            tag: "CPUC"
          },
          {
            title: "CPUC AB-67 / PUC 913 report: CA electric & gas utility costs report (revenue requirement context)",
            url: "https://www.cpuc.ca.gov/-/media/cpuc-website/divisions/office-of-governmental-affairs-division/reports/2025/ab67_puc913_102425.pdf",
            tag: "CPUC"
          }
        ],
        vpp: [
          {
            title: "Tesla VPP (DSGS): overview (California program)",
            url: "https://www.tesla.com/support/energy/virtual-power-plant/dsgs",
            tag: "Tesla"
          }
        ]
      }
    };

    /***************
      HELPERS
    ****************/
    const fmt$ = (n) => {
      if (!isFinite(n)) return "—";
      return n.toLocaleString(undefined, { style:"currency", currency:"USD", maximumFractionDigits:0 });
    };
    const fmt$2 = (n) => {
      if (!isFinite(n)) return "—";
      return n.toLocaleString(undefined, { style:"currency", currency:"USD", maximumFractionDigits:2 });
    };
    const clamp = (n, min, max) => Math.min(Math.max(n, min), max);

    function projectTotal(monthly, escPct, years=25){
      // monthly in dollars, escPct in percent
      const r = (escPct || 0) / 100;
      let total = 0;
      let rows = [];
      for(let y=1; y<=years; y++){
        const yearCost = (monthly * 12) * Math.pow(1+r, y-1);
        total += yearCost;
        rows.push({ y, yearCost });
      }
      return { total, rows };
    }

    function computeSavingsRows(utilRows, aRows, bRows){
      return utilRows.map((u, i) => {
        const a = aRows[i]?.yearCost ?? 0;
        const b = bRows[i]?.yearCost ?? 0;
        return {
          y: u.y,
          u: u.yearCost,
          a,
          b,
          sa: u.yearCost - a,
          sb: u.yearCost - b
        };
      });
    }

    function setRootVar(key, val){ document.documentElement.style.setProperty(key, val); }

    /***************
      DOM
    ****************/
    const el = (id) => document.getElementById(id);

    const utilitySelect = el("utilitySelect");
    const utilityTag = el("utilityTag");
    const utilityColTitle = el("utilityColTitle");
    const thUtil = el("thUtil");

    const uMonthly = el("uMonthly");
    const uEsc = el("uEsc");
    const uKwh = el("uKwh");

    const aMonthly = el("aMonthly");
    const aEsc = el("aEsc");
    const aNotes = el("aNotes");

    const bMonthly = el("bMonthly");
    const bEsc = el("bEsc");
    const bNotes = el("bNotes");

    const tbody = el("tbody");

    const kpiBill = el("kpiBill");
    const kpiCents = el("kpiCents");

    const uTotal = el("uTotal");
    const uCents = el("uCents");
    const aTotal = el("aTotal");
    const bTotal = el("bTotal");
    const aSave = el("aSave");
    const bSave = el("bSave");

    const problemSources = el("problemSources");
    const vppSources = el("vppSources");
    const outageVideo = el("outageVideo");
    const checkRow = el("checkRow");

    const closeA = el("closeA");
    const closeB = el("closeB");
    const closeANotes = el("closeANotes");
    const closeBNotes = el("closeBNotes");

    const copyLinkBtn = el("copyLinkBtn");
    const resetBtn = el("resetBtn");

    const steps = Array.from(document.querySelectorAll(".step"));
    const stepSections = {
      problem: el("step-problem"),
      tou: el("step-tou"),
      storage: el("step-storage"),
      backup: el("step-backup"),
      vpp: el("step-vpp"),
      calc: el("step-calc"),
      close: el("step-close"),
    };

    /***************
      RENDER SOURCES
    ****************/
    function renderSources(list, container){
      container.innerHTML = "";
      list.forEach(s => {
        const div = document.createElement("div");
        div.className = "src";
        div.innerHTML = `
          <div style="max-width: 76ch;">
            <a href="${s.url}" target="_blank" rel="noopener">${s.title}</a>
          </div>
          <div class="tag">${s.tag || "Source"}</div>
        `;
        container.appendChild(div);
      });
    }

    function renderChecks(){
      checkRow.innerHTML = "";
      if (!VPP_CHECK_IMAGE_URLS.length) return;

      VPP_CHECK_IMAGE_URLS.slice(0,4).forEach(url => {
        const img = document.createElement("img");
        img.src = url;
        img.alt = "VPP payment example";
        img.style.width = "220px";
        img.style.maxWidth = "100%";
        img.style.borderRadius = "14px";
        img.style.border = "1px solid rgba(255,255,255,.10)";
        img.style.background = "rgba(0,0,0,.16)";
        checkRow.appendChild(img);
      });
    }

    /***************
      CALCULATE + RENDER TABLE
    ****************/
    function updateKPIs(){
      const m = parseFloat(uMonthly.value);
      kpiBill.textContent = isFinite(m) && m>=0 ? fmt$(m) : "$—";

      const kwh = parseFloat(uKwh.value);
      let cents = NaN;
      if (isFinite(m) && m>0 && isFinite(kwh) && kwh>0){
        cents = (m / kwh) * 100;
      }
      kpiCents.textContent = isFinite(cents) ? `${cents.toFixed(1)} ¢/kWh` : "— ¢/kWh";
      uCents.textContent = isFinite(cents) ? `${cents.toFixed(1)} ¢/kWh` : "— ¢/kWh";
    }

    function renderTable(rows){
      tbody.innerHTML = "";
      rows.forEach(r => {
        const tr = document.createElement("tr");

        // Make savings text colored by positive/negative
        const clsA = r.sa >= 0 ? "good" : "bad";
        const clsB = r.sb >= 0 ? "good" : "bad";

        tr.innerHTML = `
          <td class="mono">${r.y}</td>
          <td>${fmt$2(r.u)}</td>
          <td>${fmt$2(r.a)}</td>
          <td>${fmt$2(r.b)}</td>
          <td class="${clsA}">${fmt$2(r.sa)}</td>
          <td class="${clsB}">${fmt$2(r.sb)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function updateClose(){
      const aM = parseFloat(aMonthly.value);
      const bM = parseFloat(bMonthly.value);

      closeA.textContent = isFinite(aM) ? `${fmt$(aM)}/mo` : "—";
      closeB.textContent = isFinite(bM) ? `${fmt$(bM)}/mo` : "—";

      closeANotes.textContent = aNotes.value?.trim() ? aNotes.value.trim() : "Add notes (battery count, fixed payment, etc.)";
      closeBNotes.textContent = bNotes.value?.trim() ? bNotes.value.trim() : "Add notes (more storage, max TOU control, etc.)";
    }

    function recalc(){
      updateKPIs();
      updateClose();

      const uM = parseFloat(uMonthly.value);
      const uE = parseFloat(uEsc.value);
      const aM = parseFloat(aMonthly.value);
      const aE = parseFloat(aEsc.value);
      const bM = parseFloat(bMonthly.value);
      const bE = parseFloat(bEsc.value);

      const util = projectTotal(isFinite(uM)?uM:0, isFinite(uE)?uE:0, 25);
      const optA = projectTotal(isFinite(aM)?aM:0, isFinite(aE)?aE:0, 25);
      const optB = projectTotal(isFinite(bM)?bM:0, isFinite(bE)?bE:0, 25);

      uTotal.textContent = isFinite(uM) ? fmt$(util.total) : "$—";
      aTotal.textContent = isFinite(aM) ? fmt$(optA.total) : "$—";
      bTotal.textContent = isFinite(bM) ? fmt$(optB.total) : "$—";

      const saveA = util.total - optA.total;
      const saveB = util.total - optB.total;

      // colorize savings
      const aGood = saveA >= 0;
      const bGood = saveB >= 0;

      aSave.textContent = isFinite(aM) && isFinite(uM) ? fmt$(saveA) : "$—";
      bSave.textContent = isFinite(bM) && isFinite(uM) ? fmt$(saveB) : "$—";

      aSave.className = "big " + (aGood ? "good" : "bad");
      bSave.className = "big " + (bGood ? "good" : "bad");

      const rows = computeSavingsRows(util.rows, optA.rows, optB.rows);
      renderTable(rows);
    }

    /***************
      UTILITY SWITCH
    ****************/
    function applyUtility(key){
      const u = UTILITIES[key] || UTILITIES.sce;

      // Theme
      setRootVar("--utilityA", u.colors.A);
      setRootVar("--utilityB", u.colors.B);
      setRootVar("--utilityName", `"${u.label}"`);

      // Labels
      utilityTag.textContent = `${u.short} sources`;
      utilityColTitle.textContent = `Utility (${u.short})`;
      thUtil.textContent = `Utility (${u.short})`;

      // Sources
      renderSources(u.sources, problemSources);
      renderSources(u.vpp, vppSources);

      // Optional outage video
      if (OUTAGE_VIDEO_URL){
        outageVideo.src = OUTAGE_VIDEO_URL;
      } else {
        // hide iframe if not configured
        outageVideo.parentElement.parentElement.classList.add("hidden");
      }

      // Optional checks
      renderChecks();

      recalc();
    }

    /***************
      STEP NAV
    ****************/
    function setActiveStep(stepKey){
      steps.forEach(s => s.classList.toggle("active", s.dataset.step === stepKey));
      const section = stepSections[stepKey];
      if(section) section.scrollIntoView({ behavior:"smooth", block:"start" });
    }

    steps.forEach(s => s.addEventListener("click", () => setActiveStep(s.dataset.step)));

    /***************
      ACTIONS
    ****************/
    function resetInputs(){
      uMonthly.value = "";
      uEsc.value = "";
      uKwh.value = "";
      aMonthly.value = "";
      aEsc.value = "";
      aNotes.value = "";
      bMonthly.value = "";
      bEsc.value = "";
      bNotes.value = "";
      recalc();
    }

    copyLinkBtn.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(window.location.href);
        copyLinkBtn.textContent = "Copied!";
        setTimeout(()=> copyLinkBtn.textContent = "Copy Page Link", 900);
      }catch(e){
        alert("Could not copy automatically. Please copy the URL from the address bar.");
      }
    });

    resetBtn.addEventListener("click", resetInputs);

    // Recalc on input
    [uMonthly,uEsc,uKwh,aMonthly,aEsc,aNotes,bMonthly,bEsc,bNotes].forEach(inp => {
      inp.addEventListener("input", recalc);
    });

    utilitySelect.addEventListener("change", () => applyUtility(utilitySelect.value));

    // Initial
    applyUtility("sce");
    recalc();
  </script>
</body>
</html>
